{% extends 'base.html' %}

{% block title %}Grading Records List{% endblock %}

{% block content %}
<a href="/" class="btn btn-purple btn-small margin-bottom-20 inline">Back To Landing Page</a>

<form method="get" style="float: right;">
  <label>
    Max Rows:
    <input
      type="number"
      name="show_limit"
      value="{{ show_limit }}"
      min="1"
      step="1"
      style="width: 5em;"
      onchange="this.form.submit()"
    >
  </label>
</form>

<div style="margin-top: 25px; font-size: 14px;">
  <table border="1" cellpadding="6" cellspacing="0">
    <thead>
      <tr>
        <th>Record ID</th>
        <th>Item ID</th>
        <th>Sub #</th>
        <th>Item</th>
        <th>Set</th>
        <th>Language</th>
        <th>Type</th>
        <th>Company</th>
        <th>Cert</th>
        <th>Grade</th>
        <th>Cost</th>
        <th>Grade Fee</th>
        <th>Received</th>
        <th>Net</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for record in records %}
        {% set cost = record.original_item.purchase_price + record.original_item.import_fee %}
        {% set net = record.original_item.return_jpy - cost - record.grading_fee if record.original_item.return_jpy is not none else none %}
        <tr class="
          {% if record.is_cracked %}
            yellow
          {% elif record.original_item.return_jpy is not none %}
            gray
          {% endif %}
        ">
          <td>{{ record.id }}</td>
          <td>{{ record.item_id }}</td>
          <td class="centre-aligned">{{ record.submission_number }}</td>
          <td>{{ record.original_item.name }}</td>
          <td>{{ record.original_item.set_name }}</td>
          <td>{{ record.original_item.language | enum }}</td>
          <td>{{ record.original_item.category | enum }}</td>
          <td>{{ record.submission_company | grading_company_enum_format }}</td>
          <td class="centre-aligned {{ 'faint' if record.grade is none else '' }}">{{ record.cert }}</td>
          <td class="centre-aligned {{ 'faint' if record.grade is none else '' }}">
            {% if record.grade is none %}
              ''
            {% elif record.grade == record.grade | int %}
              {{ record.grade | int }}
            {% else %}
              {{ record.grade }}
            {% endif %}
          </td>
          <td class="right-aligned">{{ cost | yen }}</td>
          <td class="right-aligned {{ 'faint' if record.grade is none else '' }}">
            {{ record.grading_fee | yen }}
          </td>
          <td class="right-aligned {{ 'faint' if record.original_item.return_jpy is none else '' }}">
            {{ '' if record.original_item.return_jpy is none else record.original_item.return_jpy | yen }}
          </td>
          <td class="
            right-aligned
            {% if net is none %}
              faint
            {% elif net > 0 %}
              green
            {% endif %}
          ">
            {{ '' if record.original_item.return_jpy is none else net | yen }}
          </td>
          <td>
            <a href="/grading_record_delete/{{ record.id }}"
                    onclick="return confirm('Are you sure you want to delete this grading record?')"
                    style="color: red; margin-right: 10px;">
              Del
            </a>
            <a href="/grading_record_edit/{{ record.id }}" style="color: purple;">
              Edit
            </a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<br>

<div class="pagination">
  {% if prev_url != "none" %}
    <a href="{{ prev_url }}" class="btn btn-black btn-small"><span>Previous</span></a>
  {% else %}
    <span class="btn btn-black-disabled btn-small"><span><<< End</span></span>
  {% endif %}

  {% if next_url != "none" %}
    <a href="{{ next_url }}" class="btn btn-black btn-small"><span>Next</span></a>
  {% else %}
    <span class="btn btn-black-disabled btn-small"><span>End >>></span></span>
  {% endif %}
</div>

{% if not records %}
  <p>No grading records found.</p>
{% endif %}

<script type="module" src="/static/js/pages/grading_records_view.js"></script>
{% endblock %}
